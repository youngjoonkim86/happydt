import streamlit as st
from dotenv import load_dotenv
import os
from groq import Groq

# API Key는 보안상 .env로 옮겨도 좋음
load_dotenv()
client = Groq(api_key=os.getenv("GROQ_API_KEY"))

st.set_page_config(page_title="🎯 로또 전문가 GPT", layout="centered")
st.title("💡 로또 번호 추천 by Groq LLM")

prompt = """
        당신은 한국 로또 분석 전문가입니다.  
        다음 회차에 추천할 6개의 번호로 이루어진 조합을 5세트 제안해주세요.  
        이 번호들은 다음의 50가지 분석 기준과 전략을 모두 고려하여 선택되어야 합니다.

        1. 최근 20회차 당첨 번호 출현 빈도  
        2. 가장 오랫동안 출현하지 않은 번호(미출현수)  
        3. 연속 번호 출현 여부  
        4. 홀수-짝수 비율 (예: 3:3, 4:2)  
        5. 고정수 전략 (자주 나오는 번호 포함)  
        6. 제외수 전략 (과다 출현 번호 제거)  
        7. 번호 간 평균 간격  
        8. 번호 간 거리 분산  
        9. 번호 구간별 균형 분포 (1~15, 16~30, 31~45)  
        10. 첫 번째 숫자 기준 분포  
        11. 마지막 숫자 기준 분포  
        12. 1의 자리별 패턴 분석  
        13. 10의 자리별 분포  
        14. 평균값 및 중앙값  
        15. 표준편차  
        16. 번호 크기 순서 패턴  
        17. 합계 값 범위 (예: 100~200)  
        18. 직전 회차와의 중복 번호 제거  
        19. 최근 5회차 미출현 번호 우선 고려  
        20. 홀짝 패턴 반복 차단  
        21. 연번 2개 이상 방지  
        22. 3배수 또는 5배수 포함 여부  
        23. 이전 회차 보너스 번호 포함 여부  
        24. 최근 10회차 당첨 번호에 없는 번호 가중치 상승  
        25. 2~3개의 번호를 동일 구간에서 선택  
        26. 번호 클러스터링 전략  
        27. 앞쪽 중심 조합 vs 뒤쪽 중심 조합 분리  
        28. 자주 나오는 번호의 최근 흐름 고려  
        29. 구간별 적중률 통계 기반  
        30. 번호 조합의 분산도  
        31. 연속 미출현 회차 수 기반  
        32. 숫자 피라미드 전략  
        33. 대칭 구조 조합 여부  
        34. 번호 위치 변화량 분석  
        35. 회차별 반복번호 빈도  
        36. 역사상 가장 많이 나온 번호 우선 포함  
        37. 전체 번호 분포의 자연스러움  
        38. 너무 낮거나 높은 번호 회피  
        39. 번호 길이 분포 분석  
        40. 최근 3회차 패턴 비슷하지 않게 구성  
        41. 수동/자동 선택 통계 기반 조합  
        42. 기존 우승 조합 구조 모방  
        43. 한 번호 간격 추출 전략  
        44. 전체 번호 가중치 기반 랜킹 조합  
        45. 지역적 출현 경향 분석 (참고용)  
        46. 짝수 시작 여부  
        47. 홀수 시작 여부  
        48. 추천 번호 간 시각적 분포  
        49. 역대 당첨 번호에 없는 조합 우선  
        50. 이상치 번호 제거  
        51. 특정 회차 간격으로 반복 등장하는 번호 추적  
        52. 짝수 위주로 당첨된 회차의 후속 흐름 분석  
        53. 홀수 쏠림 회차 이후 번호 패턴 반전 분석  
        54. 1~10번대 번호 집중 출현 시 그다음 회차 경향  
        55. 40번대 다수 출현 후 다음 회차 번호 분산 전략  
        56. 지난 10년간 특정 월(月)에 자주 등장한 번호 우선  
        57. 계절별 출현 패턴 고려 (예: 여름, 겨울 차이)  
        58. 연속으로 당첨된 번호 제외 전략  
        59. 최근 5회차에서 한 번도 등장하지 않은 번호 우선  
        60. 같은 위치(예: 첫 번째 번호)에서 자주 나온 숫자 추적  
        61. 번호 간 3의 배수 비율 조정  
        62. 당첨 번호 중 쌍둥이 수(예: 22, 33) 출현 여부 분석  
        63. 낮은 숫자(1~10) 연속 출현 시 패턴 반전  
        64. 수학적 소수(Prime Number) 포함 전략  
        65. 번호 간 평균 거리 6~10 유지 전략  
        66. 당첨 번호 간 최대/최소 차이 분석  
        67. 누적 합계 120~170 사이로 조정  
        68. 특정 번호 끝자리를 맞춘 조합 (예: 7, 17, 27)  
        69. 가장 자주 당첨된 조합 패턴(2-2-2 구간 분포) 모방  
        70. 특정 보너스 번호와 짝으로 자주 나오는 번호 포함  
        71. 동일 번호가 앞 회차 포함되었는지 여부 고려  
        72. 이전 회차 홀짝 비율 반전 전략 적용  
        73. 짝수 시작 회차 후 홀수 시작 패턴 반복 분석  
        74. 숫자 총합이 특정 구간에 몰린 회차 제외  
        75. 너무 낮거나 너무 높은 평균값 방지  
        76. 피보나치 수열 기반 번호 조합 전략  
        77. 번호 분포 히스토그램 기반 균형 조정  
        78. 데이터 기반 3회차 주기 순환 패턴 반영  
        79. 단일 구간(예: 1~15) 편중 시 다음 회차 분산 전략  
        80. 최근 20회 내 중복 조합 제외  
        81. 고정수 + 변동수 혼합 전략 (3+3 구성)  
        82. 지그재그 패턴을 따르는 번호 구성  
        83. 번호 간 평균 편차를 기준으로 조합 선정  
        84. 미출현 번호 중 출현 확률 높은 순 우선 고려  
        85. 특정 번호와 항상 함께 나오는 "짝번호" 우선  
        86. 추천 번호 전체의 균형 있는 시각적 분포 고려  
        87. 회차별 짝수 간 거리 통계 기반 예측  
        88. 동일 위치에서 반복되는 번호 조합 제거  
        89. 가장 최근 당첨 번호 구조 재현 제한  
        90. 동일한 끝자리 번호(예: 1, 11, 21) 초과 방지  
        91. 대칭 형태 조합(예: 6-15-23-31-39-45) 우선  
        92. 회차별 "무지개 패턴"(고르게 분산된 수) 적용  
        93. 상위 10개 빈출 번호 중 1~2개 포함 필수  
        94. 연속 번호가 2쌍 이상 포함되지 않도록 조정  
        95. 특정 구간 4개 이상 편중되면 제거  
        96. 로또 1등 당첨자 분석 기반 추천 방식 적용  
        97. 시뮬레이션 기반 로또 추첨 결과 학습 기반 추천  
        98. 가장 최근에 나온 번호들 우선 제외  
        99. 반자동 번호 분석 패턴 기반 혼합 전략  
        100. 머신러닝 기반 추세선 상 위치한 번호 추천

        이상의 조건을 종합적으로 고려하여 아래와 같은 형식으로 추천 번호를 제시해주세요:
        1번 추천 : 5, 12, 19, 27, 34, 41
        2번 추천 : 3, 7, 18, 25, 36, 43
        3번 추천 : 11, 14, 22, 29, 31, 38
        4번 추천 : 6, 10, 15, 20, 35, 42
        5번 추천 : 2, 9, 16, 23, 30, 39


        결과는 한글로 작성해주세요.  
        추천 결과는 참고용이며, 당첨을 보장하지 않습니다.

        """
    

if st.button("🎲 번호 추천받기"):
    with st.spinner("AI가 분석 중입니다..."):
        completion = client.chat.completions.create(
            model="llama3-8b-8192",  # 또는 llama3-8b-8192 등
            messages=[
                {
                    "role": "user",
                    "content": prompt
                }
            ],
            temperature=0.7,
            max_tokens=500,
            stream=False,
        )
        result = completion.choices[0].message.content
        st.success("추천이 완료되었습니다!")
        st.markdown(f"### 🧠 GPT 추천 번호\n{result}")
